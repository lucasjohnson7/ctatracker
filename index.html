<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="refresh" content="1800" />
  <link rel="stylesheet" href="style.css" />
  <title>CTA Wall — Southport</title>
</head>

<body>

<header>
  <div class="timestamp" id="timestamp">Loading…</div>
</header>

<section class="list">

  <div class="marquee">
    <span class="station-label">Brown Line → Loop</span>
    <img src="./images/train.png" class="runner" id="trainLoopRun" />
  </div>
  <div id="trainLoopBody" class="arrival-group">Loading…</div>

  <div class="marquee">
    <span class="station-label">Brown Line → Kimball</span>
    <img src="./images/train.png" class="runner" id="trainKimballRun" />
  </div>
  <div id="trainKimballBody" class="arrival-group">Loading…</div>

  <div class="marquee">
    <span class="station-label">#77 Eastbound → Lake Shore</span>
    <img src="./images/bus.png" class="runner" id="busEastRun" />
  </div>
  <div id="busEastBody" class="arrival-group">Loading…</div>

  <div class="marquee">
    <span class="station-label">#77 Westbound → Cumberland</span>
    <img src="./images/bus.png" class="runner" id="busWestRun" />
  </div>
  <div id="busWestBody" class="arrival-group">Loading…</div>

</section>

<section class="bottom-row">
  <section class="nowplaying" id="nowplaying" aria-live="polite">
    <img id="npArt" class="np-art" alt="Album art" />
    <div class="np-meta">
      <div id="npTitle" class="np-title">Nothing playing</div>
      <div id="npArtist" class="np-artist">—</div>
      <div class="np-bar" id="npBar" hidden>
        <div class="np-bar-fill" id="npFill"></div>
      </div>
    </div>
  </section>

  <div class="info-right">
    <div class="info-top">
      <div class="weather" id="weather">
        <img class="wx-icon" src="" alt="weather icon" />
        <div class="weather-info">
          <span class="wx-temp">--°</span>
          <span class="wx-desc">Loading...</span>
        </div>
      </div>

      <div class="datetime-card">
        <div class="dt-date" id="dtDate">Thu, Nov 13</div>
        <div class="dt-time" id="dtTime">1:49 PM</div>
      </div>
    </div>

    <div class="sports-card" id="sportsCard">

      <div class="sports-team scorebug" id="sports-creighton">
        <div class="scorebug-team scorebug-away">
          <div class="team-inner">
            <img class="team-logo team-away-logo" alt="">
            <div class="team-name team-away-name">Away</div>
          </div>
          <div class="team-score team-away-score">–</div>
        </div>

        <div class="scorebug-center">
          <div class="scorebug-center-top">@</div>
          <div class="scorebug-center-line1">Loading…</div>
          <div class="scorebug-center-line2"></div>
        </div>

        <div class="scorebug-team scorebug-home">
          <div class="team-score team-home-score">–</div>
          <div class="team-inner">
            <img class="team-logo team-home-logo" alt="">
            <div class="team-name team-home-name">Home</div>
          </div>
        </div>
      </div>

      <div class="sports-team scorebug" id="sports-bulls">
        <div class="scorebug-team scorebug-away">
          <div class="team-inner">
            <img class="team-logo team-away-logo" alt="">
            <div class="team-name team-away-name">Away</div>
          </div>
          <div class="team-score team-away-score">–</div>
        </div>

        <div class="scorebug-center">
          <div class="scorebug-center-top">@</div>
          <div class="scorebug-center-line1">Loading…</div>
          <div class="scorebug-center-line2"></div>
        </div>

        <div class="scorebug-team scorebug-home">
          <div class="team-score team-home-score">–</div>
          <div class="team-inner">
            <img class="team-logo team-home-logo" alt="">
            <div class="team-name team-home-name">Home</div>
          </div>
        </div>
      </div>

      <div class="sports-team scorebug" id="sports-bears">
        <div class="scorebug-team scorebug-away">
          <div class="team-inner">
            <img class="team-logo team-away-logo" alt="">
            <div class="team-name team-away-name">Away</div>
          </div>
          <div class="team-score team-away-score">–</div>
        </div>

        <div class="scorebug-center">
          <div class="scorebug-center-top">@</div>
          <div class="scorebug-center-line1">Loading…</div>
          <div class="scorebug-center-line2"></div>
        </div>

        <div class="scorebug-team scorebug-home">
          <div class="team-score team-home-score">–</div>
          <div class="team-inner">
            <img class="team-logo team-home-logo" alt="">
            <div class="team-name team-home-name">Home</div>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<section class="pullup-card">
  <div class="pullup-person">
    <div class="pullup-initial">Colin</div>
    <div class="pullup-count" id="pullupColin">0</div>
  </div>
  <div class="pullup-divider"></div>
  <div class="pullup-person">
    <div class="pullup-initial">Lucas</div>
    <div class="pullup-count" id="pullupLucas">0</div>
  </div>
</section>

<script>
const classify = (m)=> m<=1 ? "due" : (m<=5 ? "soon" : "ok");

/* ========= Slideshow config ========= */
const SLIDESHOW_IMAGES = [
  'slideshow/3F4F1713-D60C-47E0-9CF1-B136266ED3F1.JPG',
  'slideshow/GEDC2917.JPG',
  'slideshow/GEDC2976.JPG',
  'slideshow/GEDC3257.JPG',
  'slideshow/GEDC3313.JPG',
  'slideshow/GEDC3611.JPG',
  'slideshow/IMG_0083.jpg',
  'slideshow/IMG_0134.jpg',
  'slideshow/IMG_0678.jpeg',
  'slideshow/IMG_0816.jpeg',
  'slideshow/IMG_1029.JPG',
  'slideshow/IMG_1095.JPG',
  'slideshow/IMG_1160.JPG',
  'slideshow/IMG_1161.JPG',
  'slideshow/IMG_1177.JPG',
  'slideshow/IMG_1269.JPG',
  'slideshow/IMG_1693.jpeg',
  'slideshow/IMG_4594.jpeg',
  'slideshow/IMG_4647.jpeg',
  'slideshow/IMG_7078.jpeg',
  'slideshow/IMG_7586.jpeg',
  'slideshow/IMG_7616.jpeg',
  'slideshow/IMG_8146.jpeg',
  'slideshow/IMG_8565_Original.jpeg',
  'slideshow/IMG_8686.jpeg',
  'slideshow/IMG_9362.jpeg'
];
const SLIDESHOW_INTERVAL_MS = 25000;

let slideshowIndex = 0;
let slideshowTimer = null;

function startSlideshow(){
  if (!SLIDESHOW_IMAGES.length) return;
  if (slideshowTimer) return;

  const art      = document.getElementById('npArt');
  const meta     = document.querySelector('.np-meta');
  const bar      = document.getElementById('npBar');
  const titleEl  = document.getElementById('npTitle');
  const artistEl = document.getElementById('npArtist');
  const npBox    = document.getElementById('nowplaying');
  if (!art) return;

  if (meta) meta.style.display = 'none';
  if (bar)  bar.hidden = true;

  if (titleEl){ titleEl.classList.remove('scrolling'); titleEl.innerHTML=''; }
  if (artistEl){ artistEl.classList.remove('scrolling'); artistEl.innerHTML=''; }

  art.style.display = 'block';
  if (npBox) npBox.classList.add('slideshow-mode');

  function showSlide(){
    const src = SLIDESHOW_IMAGES[slideshowIndex % SLIDESHOW_IMAGES.length];
    art.src = src;
    slideshowIndex = (slideshowIndex + 1) % SLIDESHOW_IMAGES.length;
  }

  showSlide();
  slideshowTimer = setInterval(showSlide, SLIDESHOW_INTERVAL_MS);
}

function stopSlideshow(){
  if (slideshowTimer){
    clearInterval(slideshowTimer);
    slideshowTimer = null;
  }
  const npBox = document.getElementById('nowplaying');
  if (npBox) npBox.classList.remove('slideshow-mode');
}

/* Timestamp + date/time card */
const setStamp = ()=>{
  const now = new Date();
  const ts = document.getElementById("timestamp");
  if (ts) ts.textContent = "Updated " + now.toLocaleTimeString();

  const dateEl = document.getElementById("dtDate");
  const timeEl = document.getElementById("dtTime");
  if (dateEl){
    dateEl.textContent = now.toLocaleDateString("en-US", {
      weekday:"short", month:"short", day:"numeric"
    });
  }
  if (timeEl){
    timeEl.textContent = now.toLocaleTimeString("en-US", {
      hour:"numeric", minute:"2-digit"
    });
  }
};

/* ===== Weather (Open-Meteo) ===== */
const WX_LAT=41.94, WX_LON=-87.66;
const WX_URL=`https://api.open-meteo.com/v1/forecast?latitude=${WX_LAT}&longitude=${WX_LON}&current=temperature_2m,weather_code&temperature_unit=fahrenheit`;

function isNightNow(){
  const now = new Date();
  const h = now.getHours();
  const m = now.getMinutes();
  return (h > 18) || (h === 18 && m >= 1) || (h < 6);
}
function applyThemeByTime(){
  const root = document.documentElement;
  if (isNightNow()) root.classList.add('night');
  else root.classList.remove('night');
}
applyThemeByTime();
setInterval(applyThemeByTime, 5 * 60 * 1000);

function wxIconFile(code, now=new Date()){
  const h=now.getHours(), m=now.getMinutes();
  const isDay=(h>6 && h<18)||(h===6)||(h===18&&m===0);
  if (code === 0) return isDay ? './images/sun.png' : './images/moon.png';
  if ([1,2].includes(code)) return './images/partlycloudy.png';
  if (code === 3) return './images/cloudy.png';
  if ([45,48].includes(code)) return './images/cloudy.png';
  if ([51,53,55,56,57,61,63,65,66,67,80,81,82].includes(code)) return './images/rain.png';
  if ([71,73,75,77,85,86].includes(code)) return './images/snow.png';
  if ([95,96,99].includes(code)) return './images/rain.png';
  return './images/cloudy.png';
}
function wxText(code){
  if (code === 0) return 'Clear';
  if ([1,2].includes(code)) return 'Mostly clear';
  if (code === 3) return 'Partly cloudy';
  if ([45,48].includes(code)) return 'Foggy';
  if ([51,53,55,56,57].includes(code)) return 'Drizzle';
  if ([61,63,65,66,67].includes(code)) return 'Rain';
  if ([80,81,82].includes(code)) return 'Showers';
  if ([71,73,75,77].includes(code)) return 'Snow';
  if ([85,86].includes(code)) return 'Snow showers';
  if ([95,96,99].includes(code)) return 'Thunderstorms';
  return 'Cloudy';
}
async function loadWeather(){
  try{
    const j=await (await fetch(WX_URL,{cache:'no-store'})).json();
    const t=Math.round(j.current.temperature_2m);
    const code=j.current.weather_code;

    const icon = wxIconFile(code);
    const text = wxText(code);

    const el=document.getElementById("weather");
    el.querySelector(".wx-icon").src = icon;
    el.querySelector(".wx-icon").alt = text;
    el.querySelector(".wx-temp").textContent = t+"°F";
    el.querySelector(".wx-desc").textContent = text;
  }catch{
    const el=document.getElementById("weather");
    el.querySelector(".wx-icon").src='';
    el.querySelector(".wx-desc").textContent="Weather unavailable";
  }
}

/* ===== Runner controller ===== */
function controlRunner(el, due){
  if(!el) return;
  const state=el.dataset.state||"idle";
  const marquee=el.parentElement;
  const w=marquee.clientWidth;
  const blockW=el.clientWidth||120;
  const start=-200, park=Math.max(0,w-blockW-6), exit=w+300;

  function anim(from,to,dur,done){
    el.style.visibility="visible";
    const a=el.animate(
      [{transform:`translateX(${from}px)`},{transform:`translateX(${to}px)`}],
      {duration:dur,easing:"linear",fill:"forwards"}
    );
    a.onfinish=()=>{el.style.transform=`translateX(${to}px)`;done&&done();};
  }

  if(due){
    if(state==="idle"||state==="leaving"){
      el.dataset.state="arriving";
      anim(start,park,1500,()=>el.dataset.state="parked");
    }
  } else if (state==="parked"){
    el.dataset.state="leaving";
    anim(park,exit,900,()=>{
      el.dataset.state="idle";
      el.style.visibility="hidden";
      el.style.transform=`translateX(${start}px)`;
    });
  }
}

async function fetchJSON(url){
  const r=await fetch(url,{cache:'no-store'});
  if(!r.ok) throw new Error("HTTP "+r.status+" for "+url);
  return r.json();
}

/* Train + Bus rendering */
function renderList(rows, target, runner, maxRows){
  const el=document.querySelector(target);
  if(!rows.length){
    el.innerHTML=`<div class="row empty">No predictions</div>`;
    controlRunner(document.querySelector(runner), false);
    return;
  }
  const limit = typeof maxRows === 'number' ? maxRows : 4;
  let anyDue=false;
  el.innerHTML=rows.slice(0,limit).map(x=>{
    const mins=Math.max(0,Math.round((new Date(x.arrT)-new Date())/60000));
    if(mins<=1) anyDue=true;
    const eta=mins<=1?"DUE":`${mins} min`;
    return `<div class="row ${classify(mins)}">
      <div class="meta">
        <div class="route">Brown Line #${x.rn}</div>
        <div class="dest">${x.destNm}</div>
      </div>
      <div class="eta">${eta}</div>
    </div>`;
  }).join("");
  controlRunner(document.querySelector(runner), anyDue);
}

async function loadTrains(){
  try{
    // NEW: read from local JSON written by poller.py
    const data = await fetchJSON("./data/train.json");
    const rows = data.rows || [];
    const loopRows    = rows.filter(x=>/Loop/i.test(x.stpDe||""));
    const kimballRows = rows.filter(x=>/Kimball/i.test(x.stpDe||""));
    renderList(loopRows,    "#trainLoopBody",   "#trainLoopRun", 2);
    renderList(kimballRows, "#trainKimballBody","#trainKimballRun", 3);
  }catch(e){
    console.error("train load error", e);
    document.querySelector("#trainLoopBody").innerHTML="<div class='row empty'>Error</div>";
    document.querySelector("#trainKimballBody").innerHTML="<div class='row empty'>Error</div>";
  }
}

function renderBus(rows, target, runner, maxRows){
  const el=document.querySelector(target);
  if(!rows.length){
    el.innerHTML=`<div class="row empty">No predictions</div>`;
    controlRunner(document.querySelector(runner), false);
    return;
  }
  const limit = typeof maxRows === 'number' ? maxRows : 4;
  let anyDue=false;
  el.innerHTML=rows.slice(0,limit).map(x=>{
    const mins=x.prdctdn==="DUE"?0:parseInt(x.prdctdn,10);
    if(mins<=1) anyDue=true;
    const eta=mins<=1?"DUE":`${mins} min`;
    return `<div class="row ${classify(mins)} bus-row">
      <div class="meta">
        <div class="route">#77 Vehicle ${x.vid}</div>
        <div class="dest">${x.des}</div>
      </div>
      <div class="eta">${eta}</div>
    </div>`;
  }).join("");
  controlRunner(document.querySelector(runner), anyDue);
}

async function loadBuses(){
  try{
    // NEW: read from local JSON written by poller.py
    const [east,west]=await Promise.all([
      fetchJSON("./data/bus_east.json"),
      fetchJSON("./data/bus_west.json")
    ]);
    renderBus(east.rows||[], "#busEastBody", "#busEastRun", 3);
    renderBus(west.rows||[], "#busWestBody", "#busWestRun", 3);
  }catch(e){
    console.error("bus load error", e);
    document.querySelector("#busEastBody").innerHTML="<div class='row empty'>Error</div>";
    document.querySelector("#busWestBody").innerHTML="<div class='row empty'>Error</div>";
  }
}

/* ===== Scrolling text helper ===== */
function setScrollingText(el, text){
  el.style.setProperty('--scroll-distance', '0px');
  el.classList.remove('scrolling');
  el.innerHTML = '';

  const span = document.createElement('span');
  span.textContent = text || '';
  el.appendChild(span);

  requestAnimationFrame(() => {
    const containerWidth = el.clientWidth;
    const textWidth      = span.scrollWidth;
    const overflow       = textWidth - containerWidth;

    if (overflow > 8) {
      const distance = overflow + containerWidth * 0.5;
      el.style.setProperty('--scroll-distance', distance + 'px');
      el.classList.add('scrolling');
    }
  });
}

/* ===== Sports ===== */
const SPORTS_TEAMS = [
  { id:'sports-creighton', label:'Creighton Bluejays', logo:'./images/creighton.png', key:'creighton' },
  { id:'sports-bulls',     label:'Chicago Bulls',      logo:'./images/bulls.png',     key:'bulls' },
  { id:'sports-bears',     label:'Chicago Bears',      logo:'./images/bears.png',     key:'bears' }
];
const SPORTS_STATE = {};

function formatDateLabel(dateText){
  if (!dateText) return '';
  const today = new Date();
  const guess = new Date(dateText + ' ' + today.getFullYear());
  if (!isNaN(guess.getTime())){
    const sameDay = guess.getMonth() === today.getMonth() && guess.getDate() === today.getDate();
    if (sameDay) return 'TODAY';
    return (guess.getMonth()+1) + "/" + guess.getDate();
  }
  return dateText;
}
function gameSortKey(data){
  if (!data) return Number.POSITIVE_INFINITY;
  if (data.live) return 0;
  const n = data.next;
  if (!n || !n.date) return Number.POSITIVE_INFINITY;
  const today = new Date();
  const guess = new Date(n.date + " " + today.getFullYear() + " " + (n.time || ""));
  if (!isNaN(guess.getTime())) return guess.getTime();
  return Number.POSITIVE_INFINITY;
}

function updateSportsRow(team, data){
  const row = document.getElementById(team.id);
  if (!row) return;

  const awayLogoEl   = row.querySelector('.team-away-logo');
  const homeLogoEl   = row.querySelector('.team-home-logo');
  const awayNameEl   = row.querySelector('.team-away-name');
  const homeNameEl   = row.querySelector('.team-home-name');
  const awayScoreEl  = row.querySelector('.team-away-score');
  const homeScoreEl  = row.querySelector('.team-home-score');
  const line1El      = row.querySelector('.scorebug-center-line1');
  const line2El      = row.querySelector('.scorebug-center-line2');

  awayNameEl.textContent  = '';
  homeNameEl.textContent  = '';
  awayScoreEl.textContent = '–';
  homeScoreEl.textContent = '–';
  line1El.textContent     = 'No game today.';
  line2El.textContent     = '';
  if (!data || (!data.live && !data.next)){
    awayNameEl.textContent = team.label;
    if (awayLogoEl && team.logo) awayLogoEl.src = team.logo;
    if (homeLogoEl) homeLogoEl.removeAttribute('src');
    return;
  }

  const live = data.live || null;
  const next = (!live && data.next) ? data.next : null;
  const payload = live || next;

  const isHome = (payload.homeAway || 'vs') === 'vs';
  const ourName = team.label;
  const ourLogo = team.logo;
  const oppName = payload.opponentName || 'Opponent';
  const oppLogo = payload.opponentLogo || '';

  let homeName, homeLogo, awayName, awayLogo;
  if (isHome){
    homeName = ourName; homeLogo = ourLogo;
    awayName = oppName; awayLogo = oppLogo;
  } else {
    awayName = ourName; awayLogo = ourLogo;
    homeName = oppName; homeLogo = oppLogo;
  }

  awayNameEl.textContent = awayName;
  homeNameEl.textContent = homeName;

  if (awayLogoEl){
    const resolved = awayLogo || (awayName === ourName ? ourLogo : '');
    if (resolved) awayLogoEl.src = resolved; else awayLogoEl.removeAttribute('src');
  }
  if (homeLogoEl){
    const resolved = homeLogo || (homeName === ourName ? ourLogo : '');
    if (resolved) homeLogoEl.src = resolved; else homeLogoEl.removeAttribute('src');
  }

  if (live){
    const usScore = (typeof live.usScore === 'number') ? live.usScore : null;
    const themScore = (typeof live.themScore === 'number') ? live.themScore : null;
    let homeScore=null, awayScore=null;
    if (isHome){ homeScore=usScore; awayScore=themScore; }
    else { homeScore=themScore; awayScore=usScore; }

    awayScoreEl.textContent = Number.isFinite(awayScore) ? awayScore : '–';
    homeScoreEl.textContent = Number.isFinite(homeScore) ? homeScore : '–';

    const statusBits = [live.period, live.clock].filter(Boolean);
    line1El.textContent = statusBits.join(' ').trim() || 'LIVE';
    line2El.textContent = '';
  } else if (next){
    awayScoreEl.textContent = '–';
    homeScoreEl.textContent = '–';
    line1El.textContent = formatDateLabel(next.date);
    line2El.textContent = next.time || '';
  }
}

function renderSportsFromState(){
  const card = document.getElementById('sportsCard');
  if (!card) return;

  const states = SPORTS_TEAMS.map(team => ({
    team,
    data: (SPORTS_STATE[team.key] && SPORTS_STATE[team.key].data) || null
  }));

  states.forEach(({team, data}) => updateSportsRow(team, data));

  const sorted = states.slice().sort((a,b)=> gameSortKey(a.data) - gameSortKey(b.data));
  sorted.forEach(({team}) => {
    const row = document.getElementById(team.id);
    if (row) card.appendChild(row);
  });
}

async function fetchTeamStatus(team){
  try{
    // NEW: local JSON written by poller.py
    const res = await fetch(`./data/sports_${encodeURIComponent(team.key)}.json`, { cache: 'no-store' });
    if (!res.ok) throw new Error('bad status');
    const data = await res.json();
    SPORTS_STATE[team.key] = { data };
  }catch(e){
    console.error('sports error', team.key, e);
    SPORTS_STATE[team.key] = { data: null };
  }
  renderSportsFromState();
}
function loadSports(){ SPORTS_TEAMS.forEach(fetchTeamStatus); }
setInterval(loadSports, 120000);

/* ===== Now Playing ===== */
async function loadNowPlaying(){
  try{
    // NEW: local JSON written by poller.py
    const r = await fetch('./data/now_playing.json', { cache:'no-store' });
    if (!r.ok) throw new Error('now-playing error');
    const j = await r.json();

    const art      = document.getElementById('npArt');
    const titleEl  = document.getElementById('npTitle');
    const artistEl = document.getElementById('npArtist');
    const bar      = document.getElementById('npBar');
    const fill     = document.getElementById('npFill');
    const meta     = document.querySelector('.np-meta');

    const hasRealTrack =
      j && j.playing && j.title && j.title.toLowerCase() !== 'spotify';

    if (hasRealTrack){
      stopSlideshow();
      if (meta) meta.style.display = 'block';

      setScrollingText(titleEl, j.title || 'Playing…');
      setScrollingText(artistEl, [j.artist, j.album].filter(Boolean).join(' — ') || '—');

      if (j.image) { art.src = j.image; art.style.display = 'block'; }
      else { art.removeAttribute('src'); art.style.display = 'none'; }

      if (Number.isFinite(j.positionMs) && Number.isFinite(j.durationMs) && j.durationMs > 0){
        const pct = Math.max(0, Math.min(100, (j.positionMs / j.durationMs) * 100));
        fill.style.width = pct.toFixed(1) + '%';
        bar.hidden = false;
      } else {
        bar.hidden = true;
      }
    } else {
      startSlideshow();
    }
  } catch(e){
    console.error(e);
    startSlideshow();
  }
}

/* Full page reload every 30 min to reclaim Chromium memory */
setTimeout(()=> location.reload(), 30 * 60 * 1000);

/* cadence */
async function refresh(){
  await Promise.all([loadTrains(), loadBuses()]);
  setStamp();
}
refresh();
setInterval(refresh, 20000);

loadWeather();
setInterval(loadWeather, 300000);

setStamp();
setInterval(setStamp, 60000);

loadNowPlaying();
setInterval(loadNowPlaying, 10000);

loadSports();

/* ===== Pull-up Counter ===== */
function bumpAnim(el){
  el.classList.remove('pullup-bump');
  void el.offsetWidth;
  el.classList.add('pullup-bump');
}

async function loadPullups(){
  try{
    const j=await(await fetch('/api/pullups',{cache:'no-store'})).json();
    document.getElementById('pullupColin').textContent=j.colin||0;
    document.getElementById('pullupLucas').textContent=j.lucas||0;
  }catch(e){ console.error('pullup load error',e); }
}

async function pullupAction(person,action){
  try{
    const j=await(await fetch(`/api/pullups/${person}/${action}`,{method:'POST'})).json();
    const el=document.getElementById(person==='colin'?'pullupColin':'pullupLucas');
    el.textContent=j.count;
    bumpAnim(el);
  }catch(e){ console.error('pullup action error',e); }
}

document.addEventListener('keydown',(e)=>{
  if(e.target.tagName==='INPUT'||e.target.tagName==='TEXTAREA') return;
  const k=e.key.toUpperCase();
  if(k==='C') pullupAction('colin','inc');
  else if(k==='X') pullupAction('colin','dec');
  else if(k==='L') pullupAction('lucas','inc');
  else if(k==='K') pullupAction('lucas','dec');
});

loadPullups();
setInterval(loadPullups, 60000);
</script>

</body>
</html>
